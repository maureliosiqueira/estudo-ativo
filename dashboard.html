<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Estudo Ativo - Dashboard</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="header-content">
      <img src="logo.png" alt="Logomarca Estudando T.I." class="logo">
      <h1>üìö Estudo Ativo</h1>
      <button id="logoutBtn" class="btn btn-outline">Sair</button>
    </div>
  </header>

  <!-- Main Content -->
  <main class="container">
    <!-- User Info Card -->
    <section class="user-card">
      <div class="avatar">
        <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="#6c757d">
          <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-1.67 0-3.17-.84-4-2.15V17h8v-4.85C15.17 13.16 13.67 14 12 14z"/>
        </svg>
      </div>
      <div class="user-info">
        <h3>Bem-vindo, <span id="userName">...</span>!</h3>
        <p>
          <strong>Plano:</strong> 
          <span id="userPlan">Gratuito</span>
          <button id="upgradeBtn" class="btn btn-outline" style="margin-left: 10px; font-size: 0.85rem;">Torne-se Premium</button>
        </p>
        <p><strong>Limite di√°rio:</strong> <span id="daily-status">Carregando...</span></p>
      </div>
    </section>

    <!-- Topics Section -->
    <section class="topics-section">
      <h2>üìò T√≥picos Dispon√≠veis</h2>
      <div class="topics-grid">
        <div class="topic-card" onclick="loadTopic('seguranca')">
          <h3>Seguran√ßa da Informa√ß√£o</h3>
          <p>(50 quest√µes gratuitas)</p>
        </div>
        <!-- Adicione mais t√≥picos aqui -->
      </div>
    </section>

    <!-- Question Container -->
    <section id="question-container" class="question-container" style="display:none;">
      <div class="question-header">
        <h2 id="topic-title">T√≥pico</h2>
        <button onclick="nextQuestion()" class="btn btn-primary">Pr√≥xima Quest√£o</button>
      </div>
      <div id="question-box" class="question-box"></div>

      <!-- Sistema Avan√ßado de Anota√ß√µes -->
      <div id="notes-section" class="notes-section">
        <h3>Meu Estudo</h3>

        <div class="note-field">
          <label>O que eu aprendi?</label>
          <textarea id="note_learned" rows="3" placeholder="Resuma com suas palavras o conceito-chave desta quest√£o..."></textarea>
        </div>

        <div class="note-field">
          <label>Meus coment√°rios</label>
          <textarea id="note_comments" rows="3" placeholder="D√∫vidas, insights, analogias, links √∫teis..."></textarea>
        </div>

        <div class="pdf-section">
          <h4>üìö PDFs Relacionados</h4>
          <div id="pdf-links">
            <!-- PDFs ser√£o carregados dinamicamente aqui -->
          </div>
        </div>

        <button onclick="saveNotes()" class="btn btn-primary" style="margin-top: 10px;">Salvar Anota√ß√µes</button>
      </div>
    </section>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p>Siga-me nas redes:</p>
    <div class="social-links">
      <a href="https://www.youtube.com/channel/UCFLK2Bw4KIDwiKd9pN_tI7Q" target="_blank" rel="noopener" aria-label="YouTube">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#ff0000">
          <path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"/>
        </svg>
      </a>
      <a href="https://www.linkedin.com/in/marco-aur%C3%A9lio-santos-aa8552106/" target="_blank" rel="noopener" aria-label="LinkedIn">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#0077b5">
          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.63h-3.558v-9.732h3.377v1.438h.046c.47-1.072 1.618-2.207 3.324-2.207 3.57 0 6.287 2.338 6.287 7.33v5.57z"/>
          <circle cx="4.9" cy="5.5" r="2.5" fill="#0077b5"/>
        </svg>
      </a>
      <a href="https://marcoa-siqueira.hotmart.host/link-na-bio-e616b52b-be28-49bb-b8ed-68c93807705a" target="_blank" rel="noopener" aria-label="Hotmart">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="#ff6b35">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
      </a>
    </div>
    <p class="copyright">¬© 2025 Estudo Ativo ‚Ä¢ Todos os direitos reservados</p>
  </footer>

  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

  <!-- Configura√ß√£o do Firebase -->
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCZ5Pgzv08pcR6Xfp-SdjdYmqqSw7brNQ4",
      authDomain: "estudo-ativo-projeto.firebaseapp.com",
      projectId: "estudo-ativo-projeto",
      storageBucket: "estudo-ativo-projeto.firebasestorage.app",
      messagingSenderId: "257330913879",
      appId: "1:257330913879:web:4babb1b1fa4a77cd7bb912",
      measurementId: "G-SJT94J9CP7"
    };
    firebase.initializeApp(firebaseConfig);
  </script>

  <!-- Autentica√ß√£o e Logout -->
  <script>
    function signOutUser() {
      firebase.auth().signOut().then(() => {
        localStorage.removeItem('isPremium');
        localStorage.removeItem('estudoAtivo.lastDate');
        localStorage.removeItem('estudoAtivo.dailyCount');
        window.location.href = 'index.html';
      }).catch((error) => {
        console.error("Erro ao sair:", error);
        alert("N√£o foi poss√≠vel encerrar a sess√£o.");
      });
    }

    window.addEventListener('load', () => {
      firebase.auth().onAuthStateChanged(user => {
        if (!user) {
          window.location.href = 'index.html';
        } else {
          document.getElementById('userName').textContent = user.displayName || user.email || 'Usu√°rio';
        }
      });

      document.getElementById('logoutBtn')?.addEventListener('click', signOutUser);
    });
  </script>

  <!-- Limite Di√°rio e Plano -->
  <script>
    let dailyCount = 0;
    const DAILY_LIMIT_FREE = 10;

    function updateDailyStatus() {
      const today = new Date().toDateString();
      const storedDate = localStorage.getItem('estudoAtivo.lastDate');
      const storedCount = parseInt(localStorage.getItem('estudoAtivo.dailyCount') || '0');

      if (storedDate !== today) {
        dailyCount = 0;
        localStorage.setItem('estudoAtivo.lastDate', today);
        localStorage.setItem('estudoAtivo.dailyCount', '0');
      } else {
        dailyCount = storedCount;
      }

      const isPremium = localStorage.getItem('isPremium') === 'true';
      document.getElementById('userPlan').textContent = isPremium ? 'Premium' : 'Gratuito';
      document.getElementById('daily-status').textContent = isPremium 
        ? 'Ilimitado (Premium)' 
        : `${dailyCount}/${DAILY_LIMIT_FREE} (gratuito)`;
    }

    function incrementDailyCount() {
      dailyCount++;
      localStorage.setItem('estudoAtivo.dailyCount', dailyCount.toString());
      updateDailyStatus();
    }

    function canAnswerMore() {
      const isPremium = localStorage.getItem('isPremium') === 'true';
      return isPremium || dailyCount < DAILY_LIMIT_FREE;
    }

    updateDailyStatus();
  </script>

  <!-- Upgrade para Premium -->
  <script>
    document.getElementById('upgradeBtn')?.addEventListener('click', () => {
      if (localStorage.getItem('isPremium') === 'true') {
        alert('Voc√™ j√° √© um usu√°rio Premium!');
        return;
      }
      if (confirm('Deseja desbloquear acesso ilimitado a todas as quest√µes e PDFs?')) {
        window.open('https://marcoa-siqueira.hotmart.host/link-na-bio-e616b52b-be28-49bb-b8ed-68c93807705a', '_blank');
        setTimeout(() => {
          if (confirm('‚úÖ Pagamento confirmado!\nAtivar plano Premium agora?')) {
            localStorage.setItem('isPremium', 'true');
            location.reload();
          }
        }, 1500);
      }
    });
  </script>

  <!-- Quest√µes e Anota√ß√µes Avan√ßadas -->
  <script>
    let currentTopic = null;
    let currentQuestionIndex = 0;
    let currentNoteQuestionId = null;

    async function loadTopic(topicKey) {
      const isPremium = localStorage.getItem('isPremium') === 'true';
      let file = isPremium ? `${topicKey}-premium.json` : `${topicKey}-gratuito.json`;

      try {
        const res = await fetch(`topicos/${file}`);
        currentTopic = await res.json();
        currentQuestionIndex = 0;
        showQuestion();
        document.getElementById('topics-section').style.display = 'none';
        document.getElementById('question-container').style.display = 'block';
        document.getElementById('topic-title').textContent = currentTopic.titulo;
      } catch (e) {
        alert('Erro ao carregar t√≥pico. Verifique se o arquivo existe.');
      }
    }

    function showQuestion() {
      if (!canAnswerMore()) {
        document.getElementById('question-box').innerHTML = `
          <p>‚ö†Ô∏è Limite di√°rio atingido! Volte amanh√£ ou 
          <a href="#" onclick="document.getElementById('upgradeBtn').click()">torne-se premium</a>.
          </p>
        `;
        return;
      }
      const q = currentTopic.questoes[currentQuestionIndex];
      document.getElementById('question-box').innerHTML = `
        <p><strong>Quest√£o ${q.id} de ${currentTopic.questoes.length}</strong></p>
        <p>${q.enunciado}</p>
        <ul>${q.alternativas.map(a => `<li><label><input type="radio" name="q"> ${a}</label></li>`).join('')}</ul>
        <button onclick="showAnswer(${q.id})">Ver Resposta</button>
      `;
      loadNotesAndPDFs(q.id);
    }

    function showAnswer(id) {
      const q = currentTopic.questoes[currentQuestionIndex];
      document.getElementById('question-box').innerHTML += `
        <div class="answer">
          <p><strong>Resposta correta:</strong> ${q.resposta_correta}</p>
          <p><em>${q.explicacao}</em></p>
        </div>
      `;
      incrementDailyCount();
    }

    function nextQuestion() {
      if (++currentQuestionIndex < currentTopic.questoes.length) {
        showQuestion();
      } else {
        alert('Fim do t√≥pico!');
        location.reload();
      }
    }

    // --- Sistema Avan√ßado de Anota√ß√µes ---
    function loadNotesAndPDFs(questionId) {
      currentNoteQuestionId = questionId;
      const saved = localStorage.getItem(`notes_${questionId}`);
      if (saved) {
        const notes = JSON.parse(saved);
        document.getElementById('note_learned').value = notes.learned || '';
        document.getElementById('note_comments').value = notes.comments || '';
      } else {
        document.getElementById('note_learned').value = '';
        document.getElementById('note_comments').value = '';
      }

      const q = currentTopic.questoes.find(q => q.id === questionId);
      const container = document.getElementById('pdf-links');
      if (q && q.pdfs_relacionados && q.pdfs_relacionados.length > 0) {
        container.innerHTML = q.pdfs_relacionados.map(pdf => 
          `<a href="${pdf}" target="_blank" rel="noopener">üìñ ${pdf.split('/').pop()}</a>`
        ).join(' ');
      } else {
        container.innerHTML = '<p>Nenhum PDF dispon√≠vel para esta quest√£o.</p>';
      }
    }

    function saveNotes() {
      if (currentNoteQuestionId === null) return;
      const notes = {
        learned: document.getElementById('note_learned').value,
        comments: document.getElementById('note_comments').value
      };
      localStorage.setItem(`notes_${currentNoteQuestionId}`, JSON.stringify(notes));
      alert('‚úÖ Anota√ß√µes salvas com sucesso!');
    }
  </script>
</body>
</html>
